tests {
  name: "Invalid PI"
  table_entry_test {
    p4info {
      indirect: "p4_pdpi/testing/main-p4info.pb.txt"
    }
    pi_table_entry_cases {
      name: "empty PI"
      pi: {
      }
    }
    pi_table_entry_cases {
      name: "Invalid Table ID"
      pi: {
        table_id: 431
      }
    }
    pi_table_entry_cases {
      name: "Missing matches"
      pi: {
        table_id: 33554433
      }
    }
    pi_table_entry_cases {
      name: "Invalid match type - Expect Exact"
      pi: {
        table_id: 33554433
        match {
          field_id: 1
          lpm {
            value: "\xff\x22"
            prefix_len: 24
          }
        }
      }
    }
    pi_table_entry_cases {
      name: "Invalid match type - Expect LPM"
      pi: {
        table_id: 33554436
        match {
          field_id: 1
          ternary {
            value: "\xff\x22"
            mask: "\xd3\x54\x12"
          }
        }
      }
    }
    pi_table_entry_cases {
      name: "Invalid match type - Expect Ternary"
      pi: {
        table_id: 33554435
        match {
          field_id: 1
          exact {
            value: "\xff\x22"
          }
        }
      }
    }
    pi_table_entry_cases {
      name: "Invalid match field id"
      pi: {
        table_id: 33554433
        match {
          field_id: 11
          exact {
            value: "\xff\x22"
          }
        }
      }
    }
    pi_table_entry_cases {
      name: "Invalid bytestring value"
      pi: {
        table_id: 33554433
        match {
          field_id: 2
          exact {
            value: "\xff\x22\x43\x45\x32"
          }
        }
      }
    }
    pi_table_entry_cases {
      name: "Invalid prefix length"
      pi: {
        table_id: 33554436
        match {
          field_id: 1
          lpm {
            value: "\xff\x22"
            prefix_len: 40
          }
        }
      }
    }
    pi_table_entry_cases {
      name: "Duplicate match field id"
      pi: {
        table_id: 33554433
        match {
          field_id: 1
          exact {
            value: "\xff\x22"
          }
        }
        match {
          field_id: 1
          exact {
            value: "\x10\x24\x32\x52"
          }
        }
      }
    }
    pi_table_entry_cases {
      name: "LPM value - masked bits set"
      pi: {
        table_id: 33554436
        match {
          field_id: 1
          lpm {
            value: "\x10\x43\x23\x12"
            prefix_len: 24
          }
        }
      }
    }
    pi_table_entry_cases {
      name: "Ternary value too long"
      pi: {
        table_id: 33554435
        match {
          field_id: 1
          ternary {
            value: "\x42\x12"
            mask: "\xff"
          }
        }
      }
    }
    pi_table_entry_cases {
      name: "Ternary value and mask too long"
      pi: {
        table_id: 33554435
        match {
          field_id: 1
          ternary {
            value: "\x42\x12"
            mask: "\xff\xff"
          }
        }
      }
    }
    pi_table_entry_cases {
      name: "Ternary value - masked bits set"
      pi: {
        table_id: 33554435
        match {
          field_id: 1
          ternary {
            value: "\x41\x00"
            mask: "\xfe\xff"
          }
        }
      }
    }
    pi_table_entry_cases {
      name: "Missing action"
      pi: {
        table_id: 33554433
        match {
          field_id: 1
          exact {
            value: "\xff\x22"
          }
        }
        match {
          field_id: 2
          exact {
            value: "\x10\x24\x32\x52"
          }
        }
      }
    }
    pi_table_entry_cases {
      name: "Invalid action"
      pi: {
        table_id: 33554433
        match {
          field_id: 1
          exact {
            value: "\xff\x22"
          }
        }
        match {
          field_id: 2
          exact {
            value: "\x10\x24\x32\x52"
          }
        }
        action {
          action_profile_member_id: 12
        }
      }
    }
    pi_table_entry_cases {
      name: "Missing action ID"
      pi: {
        table_id: 33554433
        match {
          field_id: 1
          exact {
            value: "\xff\x22"
          }
        }
        match {
          field_id: 2
          exact {
            value: "\x10\x24\x32\x52"
          }
        }
        action {
          action {
            action_id: 1
          }
        }
      }
    }
    pi_table_entry_cases {
      name: "Invalid action ID"
      pi: {
        table_id: 33554433
        match {
          field_id: 1
          exact {
            value: "\xff\x22"
          }
        }
        match {
          field_id: 2
          exact {
            value: "\x10\x24\x32\x52"
          }
        }
        action {
          action {
            action_id: 16777219
          }
        }
      }
    }
    pi_table_entry_cases {
      name: "Missing action params"
      pi: {
        table_id: 33554433
        match {
          field_id: 1
          exact {
            value: "\xff\x22"
          }
        }
        match {
          field_id: 2
          exact {
            value: "\x10\x24\x32\x52"
          }
        }
        action {
          action {
            action_id: 16777217
            params {
              param_id: 1
              value: "\x54"
            }
          }
        }
      }
    }
    pi_table_entry_cases {
      name: "Duplicate action param id"
      pi: {
        table_id: 33554433
        match {
          field_id: 1
          exact {
            value: "\xff\x22"
          }
        }
        match {
          field_id: 2
          exact {
            value: "\x10\x24\x32\x52"
          }
        }
        action {
          action {
            action_id: 16777217
            params {
              param_id: 1
              value: "\x54"
            }
            params {
              param_id: 1
              value: "\x65"
            }
          }
        }
      }
    }
    pi_table_entry_cases {
      name: "Invalid action param id"
      pi: {
        table_id: 33554433
        match {
          field_id: 1
          exact {
            value: "\xff\x22"
          }
        }
        match {
          field_id: 2
          exact {
            value: "\x10\x24\x32\x52"
          }
        }
        action {
          action {
            action_id: 16777217
            params {
              param_id: 67
              value: "\x54"
            }
            params {
              param_id: 2
              value: "\x23"
            }
          }
        }
      }
    }
    pi_table_entry_cases {
      name: "Zero LPM prefix length"
      pi: {
        table_id: 33554436
        match {
          field_id: 1
          lpm {
            value: "\x10\x32\x41\x5"
            prefix_len: 0
          }
        }
        action {
          action {
            action_id: 21257015
          }
        }
      }
    }
    pi_table_entry_cases {
      name: "Zero ternary mask"
      pi: {
        table_id: 33554435
        match {
          field_id: 1
          ternary {
            value: "\x01\x00"
            mask: "\x00"
          }
        }
        action {
          action {
            action_id: 16777219
            params {
              param_id: 1
              value: "\x54"
            }
            params {
              param_id: 2
              value: "\x23"
            }
          }
        }
      }
    }
    pi_table_entry_cases {
      name: "Action set with negative weight"
      pi: {
        table_id: 33554438
        match {
          field_id: 1
          lpm {
            value: "\xff\x00"
            prefix_len: 24
          }
        }
        action {
          action_profile_action_set {
            action_profile_actions {
              action {
                action_id: 16777217
                params {
                  param_id: 1
                  value: "\000\000\000\010"
                }
                params {
                  param_id: 2
                  value: "\000\000\000\011"
                }
              }
              weight: -1
            }
          }
        }
      }
    }
    pi_table_entry_cases {
      name: "Action set with invalid action"
      pi: {
        table_id: 33554438
        match {
          field_id: 1
          lpm {
            value: "\xff\x00"
            prefix_len: 24
          }
        }
        action {
          action_profile_action_set {
            action_profile_actions {
              action {
                action_id: 16777218
                params {
                  param_id: 1
                  value: "\000\000\000\010"
                }
                params {
                  param_id: 2
                  value: "\000\000\000\011"
                }
              }
              weight: -1
            }
          }
        }
      }
    }
  }
}

tests {
  name: "Valid PI"
  table_entry_test {
    p4info {
      indirect: "p4_pdpi/testing/main-p4info.pb.txt"
    }
    pi_table_entry_cases {
      name: "Valid PI"
      pi: {
        table_id: 33554433
        match {
          field_id: 1
          exact {
            value: "\xff\x22"
          }
        }
        match {
          field_id: 2
          exact {
            value: "\x10\x24\x32\x52"
          }
        }
        action {
          action {
            action_id: 16777217
            params {
              param_id: 1
              value: "\x54"
            }
            params {
              param_id: 2
              value: "\x23"
            }
          }
        }
      }
    }
    pi_table_entry_cases {
      name: "Valid WCMP PI"
      pi: {
        table_id: 33554438
        match {
          field_id: 1
          lpm {
            value: "\xff\x00"
            prefix_len: 24
          }
        }
        action {
          action_profile_action_set {
            action_profile_actions {
              action {
                action_id: 16777217
                params {
                  param_id: 1
                  value: "\000\000\000\010"
                }
                params {
                  param_id: 2
                  value: "\000\000\000\011"
                }
              }
              weight: 1
            }
            action_profile_actions {
              action {
                action_id: 16777217
                params {
                  param_id: 1
                  value: "\000\000\000\020"
                }
                params {
                  param_id: 2
                  value: "\000\000\000\021"
                }
              }
              weight: 2
            }
          }
        }
      }
    }
  }
}

tests {
  name: "Invalid IR"
  table_entry_test {
    p4info {
      indirect: "p4_pdpi/testing/main-p4info.pb.txt"
    }
    ir_table_entry_cases {
      name: "empty IR"
      ir: {
      }
    }
    ir_table_entry_cases {
      name: "Invalid Table Name"
      ir: {
        table_name: "table"
      }
    }
    ir_table_entry_cases {
      name: "Missing matches"
      ir: {
        table_name: "id_test_table"
      }
    }
    ir_table_entry_cases {
      name: "Invalid match type - Expect Exact"
      ir: {
        table_name: "id_test_table"
        matches {
          name: "ipv4"
          lpm {
            value {
              ipv4: "10.32.12.4"
            }
            prefix_length: 24
          }
        }
      }
    }
    ir_table_entry_cases {
      name: "Invalid match type - Expect LPM"
      ir: {
        table_name: "lpm1_table"
        matches {
          name: "ipv4"
          ternary {
            value {
              ipv4: "10.32.12.4"
            }
            mask: {
              ipv4: "255.255.255.0"
            }
          }
        }
      }
    }
    ir_table_entry_cases {
      name: "Invalid match type - Expect Ternary"
      ir: {
        table_name: "ternary_table"
        matches {
          name: "normal"
          exact {
            str: "exact"
          }
        }
      }
    }
    ir_table_entry_cases {
      name: "Invalid match field name"
      ir: {
        table_name: "id_test_table"
        matches {
          name: "field"
          exact {
            str: "exact"
          }
        }
      }
    }
    ir_table_entry_cases {
      name: "Invalid IR value"
      ir: {
        table_name: "id_test_table"
        matches {
          name: "ipv4"
          exact {
            ipv4: "a432"
          }
        }
      }
    }
    ir_table_entry_cases {
      name: "Invalid prefix length"
      ir: {
        table_name: "lpm1_table"
        matches {
          name: "ipv4"
          lpm {
            value: {
              ipv4: "10.43.23.5"
            }
            prefix_length: 40
          }
        }
      }
    }
    ir_table_entry_cases {
      name: "Duplicate match field name"
      ir: {
        table_name: "id_test_table"
        matches {
          name: "ipv6"
          exact {
            ipv6: "::ff22"
          }
        }
        matches {
          name: "ipv6"
          exact {
            ipv4: "10.24.32.52"
          }
        }
      }
    }
    ir_table_entry_cases {
      name: "LPM value - masked bits set"
      ir: {
        table_name: "lpm1_table"
        matches {
          name: "ipv4"
          lpm {
            value {
              ipv4: "10.32.41.5"
            }
            prefix_length: 24
          }
        }
      }
    }
    ir_table_entry_cases {
      name: "Ternary value too long"
      ir: {
        table_name: "ternary_table"
        matches {
          name: "normal"
          ternary {
            value {
              hex_str: "0x4142"
            }
            mask {
              hex_str: "0x54"
            }
          }
        }
        action {
          name: "action3"
          params {
            name: "arg2"
            value {
              hex_str: "0x54"
            }
          }
          params {
            name: "arg1"
            value {
              hex_str: "0x23"
            }
          }
        }
      }
    }
    ir_table_entry_cases {
      name: "Ternary value and mask too long"
      ir: {
        table_name: "ternary_table"
        matches {
          name: "normal"
          ternary {
            value {
              hex_str: "0x4142"
            }
            mask {
              hex_str: "0x4142"
            }
          }
        }
        action {
          name: "action3"
          params {
            name: "arg2"
            value {
              hex_str: "0x54"
            }
          }
          params {
            name: "arg1"
            value {
              hex_str: "0x23"
            }
          }
        }
      }
    }
    ir_table_entry_cases {
      name: "Ternary value - Invalid format"
      ir: {
        table_name: "ternary_table"
        matches {
          name: "normal"
          ternary {
            value {
              ipv4: "0x4142"
            }
            mask {
              hex_str: "0x4142"
            }
          }
        }
        action {
          name: "action3"
          params {
            name: "arg2"
            value {
              hex_str: "0x54"
            }
          }
          params {
            name: "arg1"
            value {
              hex_str: "0x23"
            }
          }
        }
      }
    }
    ir_table_entry_cases {
      name: "Ternary value - masked bits set"
      ir: {
        table_name: "ternary_table"
        matches {
          name: "normal"
          ternary {
            value {
              hex_str: "0x0100"
            }
            mask {
              hex_str: "0x02ff"
            }
          }
        }
        action {
          name: "action3"
          params {
            name: "arg2"
            value {
              hex_str: "0x54"
            }
          }
          params {
            name: "arg1"
            value {
              hex_str: "0x23"
            }
          }
        }
      }
    }
    ir_table_entry_cases {
      name: "Invalid hex_str length"
      ir: {
        table_name: "ternary_table"
        matches {
          name: "normal"
          ternary {
            value {
              hex_str: "0x100"
            }
            mask {
              hex_str: "0xfeff"
            }
          }
        }
        action {
          name: "action3"
          params {
            name: "arg2"
            value {
              hex_str: "0x54"
            }
          }
          params {
            name: "arg1"
            value {
              hex_str: "0x23"
            }
          }
        }
      }
    }
    ir_table_entry_cases {
      name: "Missing action"
      ir: {
        table_name: "id_test_table"
        matches {
          name: "ipv6"
          exact {
            ipv6: "::ff22"
          }
        }
        matches {
          name: "ipv4"
          exact {
            ipv4: "10.24.32.52"
          }
        }
      }
    }
    ir_table_entry_cases {
      name: "Missing action name"
      ir: {
        table_name: "id_test_table"
        matches {
          name: "ipv6"
          exact {
            ipv6: "::ff22"
          }
        }
        matches {
          name: "ipv4"
          exact {
            ipv4: "10.24.32.52"
          }
        }
        action {
          name: "action"
        }
      }
    }
    ir_table_entry_cases {
      name: "Invalid action name"
      ir: {
        table_name: "id_test_table"
        matches {
          name: "ipv6"
          exact {
            ipv6: "::ff22"
          }
        }
        matches {
          name: "ipv4"
          exact {
            ipv4: "10.24.32.52"
          }
        }
        action {
          name: "action3"
        }
      }
    }
    ir_table_entry_cases {
      name: "Missing action params"
      ir: {
        table_name: "id_test_table"
        matches {
          name: "ipv6"
          exact {
            ipv6: "::ff22"
          }
        }
        matches {
          name: "ipv4"
          exact {
            ipv4: "10.24.32.52"
          }
        }
        action {
          name: "action1"
          params {
            name: "arg2"
            value {
              hex_str: "0x54"
            }
          }
        }
      }
    }
    ir_table_entry_cases {
      name: "Duplicate action param name"
      ir: {
        table_name: "id_test_table"
        matches {
          name: "ipv6"
          exact {
            ipv6: "::ff22"
          }
        }
        matches {
          name: "ipv4"
          exact {
            ipv4: "10.24.32.52"
          }
        }
        action {
          name: "action1"
          params {
            name: "arg2"
            value {
              hex_str: "0x54"
            }
          }
          params {
            name: "arg2"
            value {
              hex_str: "0x65"
            }
          }
        }
      }
    }
    ir_table_entry_cases {
      name: "Invalid action param name"
      ir: {
        table_name: "id_test_table"
        matches {
          name: "ipv6"
          exact {
            ipv6: "::ff22"
          }
        }
        matches {
          name: "ipv4"
          exact {
            ipv4: "10.24.32.52"
          }
        }
        action {
          name: "action1"
          params {
            name: "param_name"
            value {
              hex_str: "0x54"
            }
          }
          params {
            name: "arg1"
            value {
              hex_str: "0x23"
            }
          }
        }
      }
    }
    ir_table_entry_cases {
      name: "Invalid parameter format"
      ir: {
        table_name: "id_test_table"
        matches {
          name: "ipv6"
          exact {
            ipv6: "::ff22"
          }
        }
        matches {
          name: "ipv4"
          exact {
            ipv4: "10.24.32.52"
          }
        }
        action {
          name: "action1"
          params {
            name: "arg2"
            value {
              hex_str: "54"
            }
          }
          params {
            name: "arg1"
            value {
              hex_str: "0x23"
            }
          }
        }
      }
    }
    ir_table_entry_cases {
      name: "Zero LPM prefix length"
      ir: {
        table_name: "lpm1_table"
        matches {
          name: "ipv4"
          lpm {
            value {
              ipv4: "10.32.41.5"
            }
            prefix_length: 0
          }
        }
        action {
          name: "NoAction"
        }
      }
    }
    ir_table_entry_cases {
      name: "Zero ternary mask"
      ir: {
        table_name: "ternary_table"
        matches {
          name: "normal"
          ternary {
            value {
              hex_str: "0x0100"
            }
            mask {
              hex_str: "0x00"
            }
          }
        }
        action {
          name: "action3"
          params {
            name: "arg2"
            value {
              hex_str: "0x54"
            }
          }
          params {
            name: "arg1"
            value {
              hex_str: "0x23"
            }
          }
        }
      }
    }
    ir_table_entry_cases {
      name: "Action set with negative weight"
      ir: {
        table_name: "wcmp_table"
        matches {
          name: "ipv4"
          lpm {
            value {
              ipv4: "0.0.255.0"
            }
            prefix_length: 24
          }
        }
        action_set {
          actions {
            action {
              name: "action1"
              params {
                name: "arg2"
                value {
                  hex_str: "0x00000008"
                }
              }
              params {
                name: "arg1"
                value {
                  hex_str: "0x00000009"
                }
              }
            }
            weight: -1
          }
        }
      }
    }
    ir_table_entry_cases {
      name: "Action set with invalid action"
      ir: {
        table_name: "wcmp_table"
        matches {
          name: "ipv4"
          lpm {
            value {
              ipv4: "0.0.255.0"
            }
            prefix_length: 24
          }
        }
        action_set {
          actions {
            action {
              name: "invalid_action1"
              params {
                name: "arg2"
                value {
                  hex_str: "0x00000008"
                }
              }
              params {
                name: "arg1"
                value {
                  hex_str: "0x00000009"
                }
              }
            }
            weight: -1
          }
        }
      }
    }
  }
}

tests {
  name: "Valid IR"
  table_entry_test {
    p4info {
      indirect: "p4_pdpi/testing/main-p4info.pb.txt"
    }
    ir_table_entry_cases {
      name: "Valid IR"
      ir: {
        table_name: "id_test_table"
        matches {
          name: "ipv6"
          exact {
            ipv6: "::ff22"
          }
        }
        matches {
          name: "ipv4"
          exact {
            ipv4: "10.24.32.52"
          }
        }
        action {
          name: "action1"
          params {
            name: "arg2"
            value {
              hex_str: "0x54"
            }
          }
          params {
            name: "arg1"
            value {
              hex_str: "0x23"
            }
          }
        }
      }
    }
    ir_table_entry_cases {
      name: "Valid WCMP IR"
      ir: {
        table_name: "wcmp_table"
        matches {
          name: "ipv4"
          lpm {
            value {
              ipv4: "0.0.255.0"
            }
            prefix_length: 24
          }
        }
        action_set {
          actions {
            action {
              name: "action1"
              params {
                name: "arg2"
                value {
                  hex_str: "0x00000008"
                }
              }
              params {
                name: "arg1"
                value {
                  hex_str: "0x00000009"
                }
              }
            }
            weight: 1
          }
          actions {
            action {
              name: "action1"
              params {
                name: "arg2"
                value {
                  hex_str: "0x00000010"
                }
              }
              params {
                name: "arg1"
                value {
                  hex_str: "0x00000011"
                }
              }
            }
            weight: 2
          }
        }
      }
    }
  }
}

